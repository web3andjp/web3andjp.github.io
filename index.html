<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Peso Jack's Treasure Hunt</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
  />
  <style>

    :root {
      font-family: "Rockwell", "Clarendon", "Century Schoolbook", "Times New Roman", serif;
      background: #1b120a;
      color: #f4e9d5;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      background:
        radial-gradient(circle at 20% 20%, rgba(217, 119, 6, 0.25), transparent 40%),
        radial-gradient(circle at 80% 10%, rgba(217, 87, 24, 0.18), transparent 35%),
        linear-gradient(135deg, #2b1a0f 0%, #160d07 60%, #0c0805 100%);
      background-attachment: fixed;
    }

    .game-shell {
      width: min(940px, 100%);
      background: linear-gradient(160deg, rgba(53, 33, 21, 0.92), rgba(36, 23, 15, 0.95));
      border: 2px solid #8b5a2b;
      border-radius: 16px;
      padding: 1.5rem 1.25rem 1.8rem;
      box-shadow:
        0 18px 50px rgba(0, 0, 0, 0.55),
        inset 0 0 0 1px rgba(255, 255, 255, 0.04);
      position: relative;
      overflow: hidden;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.6s ease;
    }

    .game-shell.show {
      opacity: 1;
      visibility: visible;
    }

    .game-shell.solved-compact .scoreboard,
    .game-shell.solved-compact .wheel-row,
    .game-shell.solved-compact .letters-panel,
    .game-shell.solved-compact .status-row,
    .game-shell.solved-compact .subtitle {
      display: none !important;
    }

    .game-shell.solved-compact {
      padding-top: 1rem;
      padding-bottom: 1rem;
    }

    .game-shell::before,
    .game-shell::after {
      content: "";
      position: absolute;
      inset: 12px;
      border: 1px dashed rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      pointer-events: none;
    }

    h1 {
      margin: 0;
      text-align: center;
      letter-spacing: 0.16em;
      font-size: 1.55rem;
      text-transform: uppercase;
      color: #fcd34d;
      text-shadow: 0 2px 12px rgba(0, 0, 0, 0.45);
    }

    .game-shell.solved-compact h1 {
      display: none;
    }

    .subtitle {
      text-align: center;
      color: #f1d6a7;
      margin: 0.4rem 0 1.2rem;
      font-size: 0.97rem;
      letter-spacing: 0.05em;
    }

    .panel {
      background: radial-gradient(circle at 35% 20%, rgba(255, 255, 255, 0.06), transparent 45%),
        linear-gradient(180deg, #2a1a11 0%, #1c120c 100%);
      border: 1px solid #8b5a2b;
      border-radius: 14px;
      padding: 1.05rem 1rem;
      box-shadow:
        inset 0 0 28px rgba(0, 0, 0, 0.45),
        0 10px 18px rgba(0, 0, 0, 0.35);
      margin-bottom: 0;
    }

    .label {
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: #e2c7a1;
      font-size: 0.78rem;
      margin-bottom: 0.65rem;
      text-align: center;
    }

    #phrase {
      display: block;
      text-align: center;
      font-size: 1.4rem;
      letter-spacing: 0.38em;
      line-height: 1.8;
      word-wrap: break-word;
      white-space: pre-wrap;
      color: #fdf3d7;
    }

    .letters {
      margin-top: 1rem;
    }

    #letters {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 0.35rem;
      justify-items: center;
    }

    @media (min-width: 640px) {
      #letters {
        grid-template-columns: repeat(9, minmax(0, 1fr));
      }
    }

    .letter {
      width: 2.1rem;
      height: 2.1rem;
      border-radius: 8px;
      border: 1px solid #c08445;
      background: linear-gradient(145deg, #3a2416, #29170f);
      color: #f8e2b8;
      font-weight: 800;
      font-size: 0.95rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.1s ease, box-shadow 0.15s ease, border-color 0.15s ease, background 0.15s ease;
      box-shadow:
        0 6px 14px rgba(0, 0, 0, 0.65),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }

    .letter:hover:not(:disabled) {
      transform: translateY(-1px);
      border-color: #fbbf24;
      background: linear-gradient(145deg, #4a2d18, #321b0f);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.7);
    }

    .letter:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.6);
    }

    .letter:disabled {
      background: #1c120d;
      color: #c4a076;
      border-color: #8b5a2b;
      cursor: default;
      box-shadow: none;
    }

    .status-row {
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.4rem;
    }

    #reset {
      display: none;
    }

    .right-column {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    #status {
      color: #f4e9d5;
      font-size: 0.98rem;
      text-align: center;
      letter-spacing: 0.04em;
    }

    #status.solved {
      color: #fcd34d;
      font-weight: 800;
      text-shadow: 0 0 14px rgba(252, 211, 77, 0.4);
    }

    #reset {
      padding: 0.5rem 1.5rem;
      border-radius: 999px;
      border: 1px solid #c08445;
      background: linear-gradient(135deg, #fbbf24, #d97706);
      color: #1b120a;
      font-weight: 900;
      letter-spacing: 0.06em;
      cursor: pointer;
      box-shadow: 0 12px 28px rgba(217, 119, 6, 0.45);
      transition: transform 0.1s ease, box-shadow 0.15s ease, filter 0.15s ease;
    }

    #reset:hover {
      filter: brightness(1.04);
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(217, 119, 6, 0.55);
    }

    #reset:active {
      transform: translateY(0);
      box-shadow: 0 10px 20px rgba(217, 119, 6, 0.48);
    }

    .tv-frame {
      width: min(940px, 100%);
      margin: 0 auto 0.9rem;
      background: linear-gradient(180deg, #3d2a1b 0%, #24160e 100%);
      border: 2px solid #8b5a2b;
      border-radius: 24px;
      padding: 1rem 1.2rem 1.4rem;
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.55),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      position: relative;
    }

    .tv-screen {
      background: radial-gradient(ellipse at center, rgba(14, 9, 6, 0.8) 0%, rgba(8, 5, 3, 0.95) 70%), #0e0906;
      border: 2px solid #8b5a2b;
      border-radius: 14px;
      height: 200px;
      overflow: hidden;
      padding: 0;
      position: relative;
      box-shadow:
        inset 0 0 24px rgba(0, 0, 0, 0.55),
        0 10px 24px rgba(0, 0, 0, 0.35);
      transition: height 0.4s ease;
    }

    .tv-frame.tall .tv-screen {
      height: 400px;
    }

    .tv-screen.story-bg {
      background: linear-gradient(180deg, #24160f 0%, #1a100b 100%);
    }

    .tv-title {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      font-size: 1.45rem;
      font-weight: 900;
      letter-spacing: 0.12em;
      color: #fcd34d;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
      z-index: 3;
      animation: titleFade 3s linear forwards, titleReturn 3s linear forwards 22s;
      pointer-events: none;
    }

    @keyframes titleFade {
      0% {
        opacity: 1;
      }
      100% {
        opacity: 0;
      }
    }

    @keyframes titleReturn {
      0% {
        opacity: 0;
      }
      20% {
        opacity: 1;
      }
      80% {
        opacity: 1;
      }
      100% {
        opacity: 0;
      }
    }

    :root {
      --story-duration: 176s;
    }

    .story-scroll {
      position: absolute;
      width: calc(100% - 2rem);
      left: 1rem;
      top: 100%;
      animation: scroll-story var(--story-duration) linear forwards;
      animation-iteration-count: 1;
      animation-delay: 0s;
      animation-fill-mode: forwards;
      opacity: 0;
      font-family: "Press Start 2P", "Rockwell", "Clarendon", "Times New Roman", serif;
      font-size: 1.12rem;
      line-height: 1.55;
      color: #f4e9d5;
      z-index: 1;
      transition: opacity 0.8s ease;
    }

    .story-scroll.fade-out {
      opacity: 0;
      animation-play-state: paused;
    }

    .story-scroll.paused {
      animation-play-state: paused;
    }

    .final-call {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      color: #fcd34d;
      font-weight: 900;
      letter-spacing: 0.06em;
      font-size: 1rem;
      opacity: 0;
      pointer-events: none;
      z-index: 9;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
      animation: flicker 2s ease-in-out infinite;
      transition: opacity 0.8s ease;
      display: none;
    }

    .final-call.show {
      opacity: 1;
      display: grid;
    }

    .cowboy-dancer {
      position: absolute;
      bottom: 8px;
      right: 8%;
      width: 220px;
      height: 260px;
      background: url("cowboy-9875212_1280.png") bottom center/contain no-repeat;
      opacity: 0;
      pointer-events: none;
      z-index: 22;
      transform-origin: 50% 100%;
      transition: opacity 0.4s ease;
      animation: cowboyDance 1.8s infinite ease-in-out;
    }

    .cowboy-dancer.show {
      opacity: 1;
    }

    @keyframes cowboyDance {
      0% {
        transform: translateY(0) rotate(-2deg) scale(1);
      }
      25% {
        transform: translateY(-8px) rotate(2deg) scale(1.02);
      }
      50% {
        transform: translateY(-4px) rotate(-1deg) scale(0.98);
      }
      75% {
        transform: translateY(-10px) rotate(3deg) scale(1.03);
      }
      100% {
        transform: translateY(0) rotate(-2deg) scale(1);
      }
    }
    @keyframes flicker {
      0%, 18%, 22%, 25%, 53%, 57%, 100% { opacity: 1; }
      20%, 24%, 55% { opacity: 0.5; }
    }


    .story-controls {
      display: flex;
      gap: 0.4rem;
      margin-top: 0.45rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .hidden {
      display: none !important;
    }

    .story-btn {
      padding: 0.3rem 0.8rem;
      border-radius: 10px;
      border: 1px solid #c08445;
      background: linear-gradient(135deg, #fcd34d, #d97706);
      color: #1b120a;
      font-weight: 800;
      letter-spacing: 0.04em;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(217, 119, 6, 0.3);
      transition: transform 0.1s ease, box-shadow 0.15s ease, filter 0.15s ease;
    }

    .story-btn:hover {
      filter: brightness(1.03);
      transform: translateY(-1px);
      box-shadow: 0 12px 22px rgba(217, 119, 6, 0.45);
    }

    .story-btn:active {
      transform: translateY(0);
      box-shadow: 0 8px 16px rgba(217, 119, 6, 0.4);
    }

    .pixel-scene {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: hidden;
      background: linear-gradient(180deg, #f59e0b 0%, #fcd34d 35%, #f4e9d5 45%, #d1b59a 65%, #8b5a2b 100%);
      opacity: 1;
      pointer-events: none;
      display: grid;
      place-items: center;
      z-index: 4;
      animation: sceneFade 1.5s linear forwards;
      animation-delay: 18s;
    }

    .pixel-sprite {
      position: absolute;
      width: 200px;
      height: 190px;
      background: url("cowboy-horse.png") center/contain no-repeat;
      image-rendering: pixelated;
      animation: rideAcross 14s linear forwards;
      animation-delay: 1s;
      animation-fill-mode: forwards;
      opacity: 0;
      left: -200px;
      bottom: 12px;
      transform: translateX(0);
      z-index: 5;
      animation-play-state: paused;
    }

    .pixel-sprite.animate {
      animation-play-state: running;
    }

    .tv-blackout {
      position: absolute;
      inset: 0;
      background: #000;
      opacity: 0;
      transition: opacity 0.8s ease;
      z-index: 6;
      pointer-events: none;
    }

    .tv-blackout.show {
      opacity: 1;
    }

    .guitar-overlay {
      position: absolute;
      inset: 0;
      background: url("guitar.png") left center/50% no-repeat;
      background-color: transparent;
      opacity: 0;
      transition: opacity 0.8s ease;
      z-index: 7;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .guitar-overlay.show {
      opacity: 1;
      z-index: 20;
    }

    .guitar-note {
      color: #fcd34d;
      font-weight: 800;
      letter-spacing: 0.06em;
      text-align: center;
      text-shadow: 0 2px 12px rgba(0, 0, 0, 0.6);
      background: rgba(0, 0, 0, 0.55);
      padding: 0.6rem 0.9rem;
      border-radius: 10px;
      max-width: 320px;
    }

    .tv-video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: right center;
      z-index: 8;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .tv-video.show {
      opacity: 1;
    }

    .money-rain {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 30;
    }

    .money-rain .bill {
      position: absolute;
      top: -80px;
      width: 120px;
      height: 60px;
      background: linear-gradient(135deg, #1f6f2e 0%, #2e8b3a 60%, #1f6f2e 100%);
      border: 4px solid #0f3d1c;
      border-radius: 8px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
      transform: translateX(-50%) rotate(0deg);
      animation-name: billFall;
      animation-timing-function: linear;
      animation-iteration-count: 1;
    }

    .money-rain .bill::before,
    .money-rain .bill::after {
      content: "";
      position: absolute;
      border: 2px solid #0f3d1c;
      border-radius: 50%;
    }

    .money-rain .bill::before {
      width: 32px;
      height: 32px;
      left: 10px;
      top: 10px;
    }

    .money-rain .bill::after {
      width: 32px;
      height: 32px;
      right: 10px;
      top: 10px;
    }

    @keyframes billFall {
      0% {
        transform: translateX(-50%) translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateX(-50%) translateY(120vh) rotate(180deg);
        opacity: 0;
      }
    }



    .desert-sun {
      position: absolute;
      top: 10%;
      left: 50%;
      width: 90px;
      height: 90px;
      transform: translateX(-50%);
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fef08a, #fbbf24 60%, rgba(217, 119, 6, 0.7) 100%);
      box-shadow: 0 0 60px rgba(251, 191, 36, 0.45);
    }

    .cactus {
      position: absolute;
      bottom: 18px;
      width: 14px;
      height: 52px;
      background: #166534;
      border-radius: 6px;
    }

    .cactus::before,
    .cactus::after {
      content: "";
      position: absolute;
      background: #166534;
      border-radius: 6px;
    }

    .cactus::before {
      width: 10px;
      height: 28px;
      left: -10px;
      top: 16px;
    }

    .cactus::after {
      width: 10px;
      height: 22px;
      right: -10px;
      top: 10px;
    }

    .rock {
      position: absolute;
      bottom: 12px;
      width: 28px;
      height: 16px;
      background: #8b5a2b;
      border-radius: 10px;
      box-shadow: 18px 6px #a16207, -12px 4px #a16207;
      opacity: 0.9;
    }

    .mountain-range {
      position: absolute;
      bottom: 40px;
      left: 0;
      right: 0;
      height: 120px;
      background:
        linear-gradient(120deg, rgba(55, 32, 20, 0.9) 0%, rgba(42, 24, 15, 0.85) 50%, rgba(24, 15, 10, 0.8) 100%),
        linear-gradient(60deg, rgba(42, 24, 15, 0.7) 0%, rgba(30, 18, 12, 0.6) 100%);
      clip-path: polygon(0% 100%, 10% 70%, 20% 82%, 30% 60%, 42% 78%, 55% 52%, 68% 76%, 80% 54%, 90% 72%, 100% 58%, 100% 100%);
      opacity: 0.9;
      filter: drop-shadow(0 6px 6px rgba(0, 0, 0, 0.35));
    }

    .sky {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, #6ec9f5 0%, #8ad5ff 40%, rgba(138, 213, 255, 0) 80%);
      z-index: 0;
    }

    .cloud {
      position: absolute;
      background: #ffffff;
      border-radius: 999px;
      filter: drop-shadow(0 6px 10px rgba(0, 0, 0, 0.2));
      opacity: 0.9;
    }

    .cloud::before,
    .cloud::after {
      content: "";
      position: absolute;
      background: #ffffff;
      border-radius: 999px;
    }

    .cloud::before {
      width: 60%;
      height: 70%;
      top: -30%;
      left: 10%;
    }

    .cloud::after {
      width: 50%;
      height: 60%;
      top: -20%;
      right: 10%;
    }

    @keyframes rideAcross {
      0% {
        transform: translateX(0);
        opacity: 1;
      }
      80% {
        transform: translateX(1200px);
        opacity: 1;
      }
      100% {
        transform: translateX(1400px);
        opacity: 0;
      }
    }

    @keyframes sceneFade {
      0% {
        opacity: 1;
      }
      80% {
        opacity: 0.5;
      }
      100% {
        opacity: 0;
      }
    }

    @keyframes scroll-story {
      0% {
        transform: translateY(0);
        opacity: 1;
      }
      100% {
        transform: translateY(-220%);
        opacity: 1;
      }
    }

    .scoreboard {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.9rem;
      margin: 0.6rem 0 1rem;
    }

    .cowpoke {
      background: linear-gradient(180deg, rgba(58, 34, 22, 0.8), rgba(42, 26, 18, 0.9));
      border: 1px solid #8b5a2b;
      border-radius: 12px;
      padding: 0.6rem 0.75rem;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      transition: transform 0.1s ease, box-shadow 0.15s ease;
    }

    .cowpoke.active-player {
      box-shadow:
        0 10px 22px rgba(0, 0, 0, 0.4),
        inset 0 0 0 1px rgba(252, 211, 77, 0.35);
      transform: translateY(-2px);
      border-color: #fcd34d;
      background: linear-gradient(180deg, rgba(75, 44, 28, 0.95), rgba(58, 34, 22, 0.95));
    }

    .cowpoke-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #e2c7a1;
      font-size: 0.78rem;
      margin-bottom: 0.35rem;
      text-align: center;
    }

    .cowpoke-score {
      font-size: 1.35rem;
      font-weight: 900;
      color: #fcd34d;
      text-align: center;
    }

    .wheel-row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.75rem;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    @media (min-width: 780px) {
      .wheel-row {
        grid-template-columns: 1.2fr 1fr;
      }
    }

    .wheel-wrapper {
      position: relative;
      width: min(340px, 100%);
      margin: 0 auto;
      aspect-ratio: 1 / 1;
      display: grid;
      place-items: center;
    }

    #wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 2px solid #8b5a2b;
      background: #0f0a07;
      transition: transform 0.2s ease;
    }

    .wheel-center {
      position: absolute;
      width: 26%;
      height: 26%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fcd34d, #d97706);
      border: 2px solid #8b5a2b;
      display: grid;
      place-items: center;
      color: #1b120a;
      font-weight: 900;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.35);
      pointer-events: none;
    }

    .pointer {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      color: #fcd34d;
      font-size: 1.4rem;
      text-shadow: 0 0 12px rgba(0, 0, 0, 0.55);
      pointer-events: none;
      z-index: 10;
    }

    .wheel-actions {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      align-items: center;
      justify-content: center;
    }

    .spin-btn {
      padding: 0.65rem 1.4rem;
      border-radius: 12px;
      border: 1px solid #c08445;
      background: linear-gradient(135deg, #fcd34d, #d97706);
      color: #1b120a;
      font-weight: 900;
      letter-spacing: 0.08em;
      cursor: pointer;
      box-shadow: 0 12px 22px rgba(217, 119, 6, 0.4);
      transition: transform 0.1s ease, box-shadow 0.15s ease, filter 0.15s ease;
    }

    .spin-btn:hover:not(:disabled) {
      filter: brightness(1.03);
      transform: translateY(-1px);
      box-shadow: 0 16px 28px rgba(217, 119, 6, 0.48);
    }

    .spin-btn:disabled {
      cursor: default;
      opacity: 0.65;
      box-shadow: none;
    }

    .wedge-readout {
      min-height: 2.4rem;
      min-width: 220px;
      border-radius: 12px;
      border: 1px solid #8b5a2b;
      background: linear-gradient(180deg, rgba(42, 26, 18, 0.9), rgba(27, 18, 10, 0.95));
      color: #f4e9d5;
      padding: 0.6rem 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      letter-spacing: 0.04em;
    }

    @media (max-width: 780px) {
      .game-shell {
        padding: 1.2rem 0.9rem 1.4rem;
      }
      .wheel-row {
        grid-template-columns: 1fr;
        justify-items: center;
      }
      .panel {
        width: 100%;
      }
      .wheel-wrapper {
        width: min(320px, 100%);
      }
    }

    @media (max-width: 960px) {
      .tv-frame {
        width: 100%;
      }
      .tv-frame.tall .tv-screen {
        height: 360px;
      }
      .game-shell {
        width: 100%;
      }
      .story-controls {
        justify-content: center;
      }
      .wheel-wrapper {
        width: min(300px, 100%);
      }
      #wheel {
        width: 300px;
        height: 300px;
      }
      .spin-btn {
        width: 100%;
      }
      .wedge-readout {
        width: 100%;
        max-width: 300px;
      }
    }

    @media (max-width: 520px) {
      body {
        padding: 1rem;
      }
      h1 {
        font-size: 1.2rem;
      }
      .subtitle {
        font-size: 0.9rem;
      }
      .label {
        font-size: 0.72rem;
      }
      #phrase {
        font-size: 1.1rem;
        letter-spacing: 0.28em;
      }
      #letters {
        grid-template-columns: repeat(6, minmax(0, 1fr));
      }
      .letter {
        width: 2rem;
        height: 2rem;
        font-size: 0.85rem;
      }
      .wheel-wrapper {
        width: min(260px, 100%);
      }
      #wheel {
        width: 260px;
        height: 260px;
      }
      .spin-btn {
        width: 100%;
      }
      .wedge-readout {
        width: 100%;
        max-width: 260px;
      }
    }
  </style>
</head>
<body>
  <audio id="wild-west-audio" src="050612_wild-west-1-36194.mp3" preload="auto"></audio>
  <audio id="western-theme-audio" src="western-theme-162884.mp3" preload="auto"></audio>
  <audio id="wheel-audio" src="wheel-spin-click-slow-down-101152.mp3" preload="auto" loop></audio>
  <audio id="ding-audio" src="ding-411634.mp3" preload="auto"></audio>
  <audio id="fail-audio" src="fail-trumpet-242645.mp3" preload="auto"></audio>
  <audio id="win-audio" src="country-happiness-playful-catch-283156.mp3" preload="auto"></audio>
  <audio id="ohno-audio" src="human-voice-saying-oh-no-301694.mp3" preload="auto"></audio>

  <div class="tv-frame tall">
    <div class="tv-screen" id="tv-screen">
      <div class="tv-title">The Legend of Peso Jack</div>
      <div class="pixel-scene" id="pixel-scene">
        <div class="sky"></div>
        <div class="desert-sun"></div>
        <div class="mountain-range"></div>
          <div class="cloud" style="top: 16%; left: 20%; width: 120px; height: 38px;"></div>
          <div class="cloud" style="top: 22%; left: 55%; width: 140px; height: 46px; opacity: 0.85;"></div>
          <div class="cloud" style="top: 12%; left: 70%; width: 110px; height: 34px; opacity: 0.8;"></div>
          <div class="cactus" style="left: 8%; height: 58px;"></div>
          <div class="cactus" style="left: 24%; height: 68px;"></div>
          <div class="cactus" style="left: 44%; height: 60px;"></div>
        <div class="cactus" style="left: 64%; height: 72px;"></div>
        <div class="cactus" style="left: 82%; height: 54px;"></div>
        <div class="cactus" style="left: 15%; height: 40px; opacity: 0.7; transform: scale(0.85);"></div>
        <div class="cactus" style="left: 35%; height: 46px; opacity: 0.75; transform: scale(0.9);"></div>
        <div class="cactus" style="left: 55%; height: 52px; opacity: 0.8; transform: scale(0.95);"></div>
        <div class="cactus" style="left: 75%; height: 44px; opacity: 0.72; transform: scale(0.88);"></div>
        <div class="rock" style="left: 22%; bottom: 12px;"></div>
        <div class="rock" style="left: 52%; bottom: 16px;"></div>
        <div class="rock" style="left: 74%; bottom: 10px;"></div>
        <div class="pixel-sprite" id="pixel-sprite" aria-hidden="true"></div>
      </div>
      <div class="tv-blackout" id="tv-blackout"></div>
      <div class="money-rain" id="money-rain"></div>
      <div class="cowboy-dancer" id="cowboy-dancer" aria-hidden="true"></div>
      <div class="guitar-overlay" id="guitar-overlay">
        <div class="guitar-note" id="guitar-note">Check the guitar chamber of Peso John</div>
      </div>
      <div class="story-scroll" id="story-scroll">
        The sun bled out over the California cliffs, a long slow spill of gold on rock and water, while a dusty wanderer
        rode along the edge of the world with saddlebags full of questions and not much else. He was called Peso Jack.
        He traveled light and liked it that way, keeping only a sun-faded bandana from his cousin Peso John, a
        six-string legend who had lately lost his final contest with dysentery. The memory of John’s last ragged riff
        still seemed to hang in the wind that came hard off the Pacific.<br><br>
        People said Jack was a story-chaser, a man who collected rumors and half-truths the way other men collected
        coins. That evening, the breeze brought him one more.<br><br>
        At a narrow overlook he saw something flutter under a stone—a scrap of parchment, set there deliberate, with no
        hoofprint or boot mark near it. Jack swung down, picked it up, and unfolded it.<br><br>
        “Eight words guard what you seek.<br>
        Find them, and the path will reveal itself.”<br><br>
        Beneath the lines someone had inked a curious mark: a circle split by a single stroke, like a sign for something
        hollow inside, something waiting to be found.<br><br>
        Jack slipped the note into his coat, touched the worn bandana at his wrist in John’s honor, and climbed back
        into the saddle. If his cousin’s ghost still had a song left in it, Jack meant to see it carried to the right
        ears.<br><br>
        The puzzle had not asked his permission. It had simply arrived.<br><br>
        Now it was his, and the journey had begun.<br><br>
        Help Peso Jack uncover the hidden phrase and unlock the next chapter of his ride.<br><br>
        Who will be the hero?<br><br>
        Player 1: Mom<br><br>
        Player 2: PaPa
      </div>
      <div class="final-call" id="final-call">Press Start Game to Begin</div>
    </div>
    <div class="story-controls">
      <button class="story-btn" id="start-show">Start Show</button>
      <button class="story-btn hidden" id="start-game">Start Game</button>
      <button class="story-btn" id="pause-story">Pause Scroll</button>
      <button class="story-btn" id="play-story">Play Scroll</button>
      <button class="story-btn hidden" id="rewind-story" aria-hidden="true" tabindex="-1">Rewind</button>
      <button class="story-btn hidden" id="test-solve">Test Solve</button>
    </div>
  </div>

  <div class="game-shell">
    <h1>Peso Jack's Wheel Of Destiny</h1>
    <p class="subtitle">Two riders take turns: spin the wheel, guess a letter, win the loot.</p>

    <div class="scoreboard">
      <div class="cowpoke" id="player-0">
        <div class="cowpoke-label">Player 1: Mom</div>
        <div class="cowpoke-score" id="score-0">0</div>
      </div>
      <div class="cowpoke" id="player-1">
        <div class="cowpoke-label">Player 2: PaPa</div>
        <div class="cowpoke-score" id="score-1">0</div>
      </div>
    </div>

    <div class="panel spacer">
      <div class="label">Puzzle Phrase</div>
      <span id="phrase"></span>
    </div>

    <div style="height: 40px;"></div>

    <div class="wheel-row">
      <div>
        <div class="wheel-wrapper">
          <div class="pointer">▼</div>
          <canvas id="wheel" width="360" height="360"></canvas>
          <div class="wheel-center">Spin</div>
        </div>
        <div style="height: 20px;"></div>
        <div class="wheel-actions">
          <button id="spin" class="spin-btn">Spin Wheel</button>
          <div id="wedge" class="wedge-readout">Waiting to spin…</div>
        </div>
      </div>
      <div class="right-column">
        <div class="panel">
          <div class="status-row">
            <div id="status">Spin the wheel to start.</div>
            <button id="reset">Reset Puzzle</button>
          </div>
        </div>
        <div class="panel letters-panel">
          <div class="label">Choose a Letter</div>
          <div id="letters"></div>
        </div>
      </div>
    </div>

  <script>
    (function () {
      const PHRASE = "THE ANSWER IS HIDDEN IN MY HOLLOW CHAMBER";
      const WEDGES = [
        "Bankrupt",
        "Lose A Turn",
        "Bite A Lemon",
        "Have A Cookie",
        "Snack Time",
        "Go On Vacation",
        "Hug A Grandkid",
        "Do A Dance",
      ];
      const PRIZE_PER_LETTER = 500;

      const phraseEl = document.getElementById("phrase");
      const lettersEl = document.getElementById("letters");
      const statusEl = document.getElementById("status");
      const resetBtn = document.getElementById("reset");
      const spinBtn = document.getElementById("spin");
      const wedgeReadout = document.getElementById("wedge");
      const wheelCanvas = document.getElementById("wheel");
      const playerEls = [document.getElementById("player-0"), document.getElementById("player-1")];
      const scoreEls = [document.getElementById("score-0"), document.getElementById("score-1")];
      const storyEl = document.getElementById("story-scroll");
      const pauseStoryBtn = document.getElementById("pause-story");
      const playStoryBtn = document.getElementById("play-story");
      const rewindStoryBtn = document.getElementById("rewind-story");
      const startShowBtn = document.getElementById("start-show");
      const startGameBtn = document.getElementById("start-game");
      const testSolveBtn = document.getElementById("test-solve");
      const pixelScene = document.getElementById("pixel-scene");
      const blackoutEl = document.getElementById("tv-blackout");
      const guitarEl = document.getElementById("guitar-overlay");
      const horseEl = document.getElementById("pixel-sprite");
      const wildAudio = document.getElementById("wild-west-audio");
      const westernAudio = document.getElementById("western-theme-audio");
      const wheelAudio = document.getElementById("wheel-audio");
      const dingAudio = document.getElementById("ding-audio");
      const failAudio = document.getElementById("fail-audio");
      const winAudio = document.getElementById("win-audio");
      const ohNoAudio = document.getElementById("ohno-audio");
      const tvScreen = document.getElementById("tv-screen");
      const moneyRain = document.getElementById("money-rain");
      const finalCall = document.getElementById("final-call");
      const cowboyDancer = document.getElementById("cowboy-dancer");
      const guitarNote = document.getElementById("guitar-note");
      const PLAYER_NAMES = ["Mom", "Papa"];
      const titleEl = document.querySelector(".tv-title");
      let storyStarted = false;
      let storyAnimation;
      let lastBankruptPlayer = null;
      let wildAudioStarted = false;
      let westernAudioStarted = false;
      let westernFadeTimeout;
      let westernPlayCount = 0;
      const WESTERN_MAX_PLAYS = 2;
      const STORY_DURATION_MS = 176000;
      let storyDirectionForward = true;
      let moneyInterval;

      function revealGameShell() {
        const gameShell = document.querySelector(".game-shell");
        if (gameShell) gameShell.classList.add("show");
        const tvFrame = document.querySelector(".tv-frame");
        if (tvFrame) tvFrame.classList.remove("tall");
      }

      function getStoryAnimation() {
        if (!storyAnimation) {
          const animations = storyEl.getAnimations();
          if (animations && animations.length) {
            storyAnimation = animations[0];
          }
        }
        return storyAnimation;
      }

      function restartStoryAnimation() {
        storyAnimation = null;
        storyEl.style.animation = "none";
        // force reflow
        // eslint-disable-next-line no-unused-expressions
        storyEl.offsetWidth;
        storyEl.style.animation = "";
        storyEl.style.animationPlayState = "running";
        storyEl.style.animationDirection = "normal";
      }

      function ensureStoryAnimation() {
        let anim = getStoryAnimation();
        if (!anim) {
          restartStoryAnimation();
          anim = getStoryAnimation();
        }
        return anim;
      }

      const ctx = wheelCanvas.getContext("2d");
      const radius = wheelCanvas.width / 2;
      const sliceAngle = (2 * Math.PI) / WEDGES.length;
      
      const sliceColors = [
        "#000000", // Bankrupt
        "#d97706",
        "#a16207",
        "#92400e",
        "#fbbf24",
        "#b45309",
        "#a855f7",
        "#d946ef",
      ];

      let guessed = new Set();
      let scores = [0, 0];
      let currentPlayer = 0;
      let spinning = false;
      let canGuess = false;
      let currentRotation = 0;
      let guitarTimeout;
      let finalCallTimeout;
      let finalCallShown = false;

      function drawWheel() {
        ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
        // place text closer to the outer edge to leave breathing room around the center medallion
        const textRadius = radius * 0.96;
        const textMaxWidth = radius * 0.7; // loosen width so labels can scale up
        // find the largest uniform font size that fits all labels
        let fontSize = 30;
        while (fontSize > 10) {
          ctx.font = `bold ${fontSize}px 'Rockwell', 'Times New Roman', serif`;
          const tooWide = WEDGES.some((label) => ctx.measureText(label).width > textMaxWidth);
          if (!tooWide) break;
          fontSize -= 1;
        }
        WEDGES.forEach((label, i) => {
          const start = i * sliceAngle;
          const end = start + sliceAngle;
          ctx.beginPath();
          ctx.moveTo(radius, radius);
          ctx.arc(radius, radius, radius - 4, start, end);
          ctx.closePath();
          ctx.fillStyle = sliceColors[i % sliceColors.length];
          ctx.fill();

          // text
          ctx.save();
          ctx.translate(radius, radius);
          ctx.rotate(start + sliceAngle / 2);
          ctx.textAlign = "right";
          ctx.textBaseline = "middle";
          ctx.fillStyle = i === 0 ? "#ffffff" : "#1b120a";
          ctx.font = `bold ${fontSize}px 'Rockwell', 'Times New Roman', serif`;
          ctx.fillText(label, textRadius, 0);
          ctx.restore();
        });
      }

      function renderPhrase() {
        const display = PHRASE.split("").map((ch) => {
          if (ch === " ") return " ";
          const upper = ch.toUpperCase();
          return guessed.has(upper) ? upper : "_";
        });
        phraseEl.textContent = display.join("");
      }

      function checkSolved() {
        for (const ch of PHRASE) {
          if (ch === " ") continue;
          if (!guessed.has(ch.toUpperCase())) return false;
        }
        return true;
      }

      function setSolvedUI() {
        statusEl.textContent = `Solved! ${PLAYER_NAMES[currentPlayer]} claims the treasure. Hope they are the sharin type!`;
        statusEl.classList.add("solved");
        lettersEl.querySelectorAll("button").forEach((btn) => (btn.disabled = true));
        spinBtn.disabled = true;
        canGuess = false;
        storyEl.classList.add("fade-out");
        if (pixelScene) {
          pixelScene.style.animation = "none";
          pixelScene.style.opacity = "1";
        }
        revealGameShell();
        const gameShell = document.querySelector(".game-shell");
        if (gameShell) gameShell.classList.add("solved-compact");
        const tvFrame = document.querySelector(".tv-frame");
        if (tvFrame) tvFrame.classList.add("tall");
        if (guitarTimeout) clearTimeout(guitarTimeout);
        guitarTimeout = setTimeout(() => {
          guitarEl.classList.add("show");
        }, 800);
        const otherPlayer = currentPlayer === 0 ? PLAYER_NAMES[1] : PLAYER_NAMES[0];
        if (guitarNote) {
          guitarNote.innerHTML = `Congratulations, ${PLAYER_NAMES[currentPlayer]}! ${otherPlayer} hopes you are the sharin' kind!<br><br>Check the guitar chamber of Peso John`;
        }
        if (cowboyDancer) cowboyDancer.classList.add("show");
        startMoneyRain();
        playWinAudio();
      }

      function setUnsolvedUI(text) {
        statusEl.textContent = text;
        statusEl.classList.remove("solved");
      }

      function updateScores() {
        scoreEls.forEach((el, idx) => (el.textContent = scores[idx]));
      }

      function highlightCurrentPlayer() {
        playerEls.forEach((el, idx) => {
          if (idx === currentPlayer) {
            el.classList.add("active-player");
          } else {
            el.classList.remove("active-player");
          }
        });
      }

      function switchPlayer(reason = "") {
        currentPlayer = currentPlayer === 0 ? 1 : 0;
        highlightCurrentPlayer();
        const prefix = reason ? `${reason} ` : "";
        setUnsolvedUI(`${prefix}${PLAYER_NAMES[currentPlayer]}, your turn to spin.`);
        canGuess = false;
      }

      function handleLetter(letter, button) {
        if (!canGuess || button.disabled) return;
        guessed.add(letter);
        button.disabled = true;

        const hits = PHRASE.split("").filter((ch) => ch === letter).length;
        if (hits > 0) {
          scores[currentPlayer] += hits * PRIZE_PER_LETTER;
          updateScores();
          playDingAudio();
          renderPhrase();
          if (checkSolved()) {
            setSolvedUI();
            return;
          }
          canGuess = false;
          setUnsolvedUI(
            `Nice find! ${hits} letter${hits > 1 ? "s" : ""} worth ${hits * PRIZE_PER_LETTER}. Spin again.`
          );
        } else {
          switchPlayer("OPE! No hits. Passing the turn.");
          playFailAudio();
          renderPhrase();
        }
        spinning = false;
        spinBtn.disabled = false;
      }

      function renderLetters() {
        lettersEl.innerHTML = "";
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach((letter) => {
          const btn = document.createElement("button");
          btn.textContent = letter;
          btn.className = "letter";
          btn.disabled = guessed.has(letter);
          btn.addEventListener("click", () => handleLetter(letter, btn));
          lettersEl.appendChild(btn);
        });
      }

      function evaluateWedge(index) {
        const wedge = WEDGES[index];
        const wedgePrefix = wedge === "Bankrupt" || wedge === "Lose A Turn" ? "OPE! " : "";
        wedgeReadout.textContent = `${wedgePrefix}Landed on: ${wedge}`;

        if (wedge === "Bankrupt") {
          scores[currentPlayer] = 0;
          updateScores();
          const chainBankrupt = lastBankruptPlayer !== null && lastBankruptPlayer !== currentPlayer;
          const prefix = chainBankrupt ? "OPE! ya'll should learn how to spin better. " : "";
          switchPlayer(`${prefix}Bankrupt! All loot lost.`);
          lastBankruptPlayer = currentPlayer;
          playFailAudio();
          spinBtn.disabled = false;
        } else if (wedge === "Lose A Turn") {
          switchPlayer("Lost the turn.");
          lastBankruptPlayer = null;
          playFailAudio();
          spinBtn.disabled = false;
        } else if (wedge === "Bite A Lemon") {
          playOhNoAudio();
          canGuess = true;
          setUnsolvedUI(`${PLAYER_NAMES[currentPlayer]}, you hit "Bite A Lemon". Guess a letter to earn ${PRIZE_PER_LETTER} per hit.`);
          spinBtn.disabled = true;
        } else {
          lastBankruptPlayer = null;
          canGuess = true;
          setUnsolvedUI(`${PLAYER_NAMES[currentPlayer]}, it's your turn. Guess a letter to earn ${PRIZE_PER_LETTER} per hit.`);
          spinBtn.disabled = true;
        }
      }

      function spinWheel() {
        if (spinning) return;
        spinning = true;
        canGuess = false;
        spinBtn.disabled = true;
        setUnsolvedUI(`${PLAYER_NAMES[currentPlayer]} is spinning...`);
        playWheelAudio();

        const rotations = 4 + Math.random() * 4; // between 4 and 8 spins
        const extraDegrees = Math.random() * 360;
        const targetRotation = currentRotation + rotations * 360 + extraDegrees;
        const duration = 3200 + Math.random() * 800;

        const start = performance.now();
        function animate(now) {
          const elapsed = now - start;
          const t = Math.min(elapsed / duration, 1);
          // ease out cubic
          const eased = 1 - Math.pow(1 - t, 3);
          const angle = currentRotation + (targetRotation - currentRotation) * eased;
          wheelCanvas.style.transform = `rotate(${angle}deg)`;
          if (t < 1) {
            requestAnimationFrame(animate);
          } else {
            currentRotation = angle % 360;
            const sliceDeg = 360 / WEDGES.length;
            const pointerDeg = 270; // top of the wheel
            const normalized = ((pointerDeg - (currentRotation % 360)) + 360) % 360;
            const index = Math.floor(normalized / sliceDeg + 1e-6) % WEDGES.length;
            evaluateWedge(index);
            spinning = false;
            stopWheelAudio();
          }
        }
        requestAnimationFrame(animate);
      }

      function resetGame() {
        guessed = new Set();
        scores = [0, 0];
        currentPlayer = 0;
        spinning = false;
        canGuess = false;
        currentRotation = 0;
        if (guitarTimeout) clearTimeout(guitarTimeout);
        blackoutEl.classList.remove("show");
        guitarEl.classList.remove("show");
        if (tvScreen) tvScreen.classList.remove("story-bg");
        if (pixelScene) {
          pixelScene.style.animation = "";
          pixelScene.style.opacity = "";
        }
        storyEl.classList.remove("fade-out");
        wheelCanvas.style.transform = "rotate(0deg)";
        wedgeReadout.textContent = "Waiting to spin…";
        updateScores();
        renderPhrase();
        renderLetters();
        highlightCurrentPlayer();
        spinBtn.disabled = false;
        setUnsolvedUI("Spin the wheel to start.");
        const gameShell = document.querySelector(".game-shell");
        if (gameShell) gameShell.classList.remove("solved-compact");
        stopMoneyRain();
        if (finalCall) {
          finalCall.classList.remove("show");
          finalCall.style.display = "none";
        }
        if (finalCallTimeout) {
          clearTimeout(finalCallTimeout);
          finalCallTimeout = null;
        }
        finalCallShown = false;
        if (cowboyDancer) cowboyDancer.classList.remove("show");
      }

      drawWheel();
      renderLetters();
      renderPhrase();
      highlightCurrentPlayer();

      spinBtn.addEventListener("click", spinWheel);
      resetBtn.addEventListener("click", resetGame);
      pauseStoryBtn.addEventListener("click", () => {
        const anim = getStoryAnimation();
        if (anim) anim.pause();
        storyEl.classList.add("paused");
        if (westernAudio) westernAudio.pause();
      });
      playStoryBtn.addEventListener("click", () => {
        const anim = getStoryAnimation();
        if (anim) {
          anim.playbackRate = 1;
          anim.play();
        }
        storyDirectionForward = true;
        storyEl.style.animationDirection = "normal";
        storyEl.style.animationPlayState = "running";
        storyEl.classList.remove("paused");
        if (westernAudio && westernPlayCount > 0) {
          westernAudio.play().catch(() => {});
        }
      });
      rewindStoryBtn.addEventListener("click", () => {
        const anim = ensureStoryAnimation();
        if (anim) {
          const timing = anim.effect && anim.effect.getComputedTiming ? anim.effect.getComputedTiming() : {};
          const duration = typeof timing.duration === "number" ? timing.duration : STORY_DURATION_MS;
          const currentTime = anim.currentTime != null ? anim.currentTime : duration;
          anim.pause();
          anim.playbackRate = -1;
          anim.currentTime = Math.min(currentTime, duration);
          anim.play();
        }
        storyEl.classList.remove("fade-out");
        storyEl.style.opacity = "1";
        storyDirectionForward = false;
        storyEl.style.animationDirection = "reverse";
        storyEl.style.animationPlayState = "running";
        storyEl.classList.remove("paused");
      });

      // Start scroll only after all title animations finish (fade and return)
      storyEl.style.animationPlayState = "paused";
      titleEl.addEventListener("animationend", (event) => {
        if (event.animationName !== "titleReturn" || storyStarted) return;
        storyStarted = true;
        storyDirectionForward = true;
        finalCallShown = false;
        if (finalCall) {
          finalCall.classList.remove("show");
          finalCall.style.display = "none";
        }
        if (finalCallTimeout) clearTimeout(finalCallTimeout);
        const anim = getStoryAnimation();
        if (anim) {
          anim.playbackRate = 1;
          anim.play();
        } else {
          storyEl.style.animationPlayState = "running";
        }
        if (westernFadeTimeout) clearTimeout(westernFadeTimeout);
        westernFadeTimeout = setTimeout(() => fadeWesternAudio(5000), STORY_DURATION_MS - 5000);
        // show final call near end of scroll and pause there
        finalCallTimeout = setTimeout(() => {
          if (finalCall && !finalCallShown) {
            finalCallShown = true;
            finalCall.style.display = "grid";
            finalCall.classList.add("show");
            storyEl.classList.add("paused");
            storyEl.style.animationPlayState = "paused";
          }
        }, STORY_DURATION_MS * 0.65);
      });

      storyEl.addEventListener("animationend", (event) => {
        if (event.animationName === "scroll-story") {
          if (westernFadeTimeout) {
            clearTimeout(westernFadeTimeout);
            westernFadeTimeout = null;
          }
          if (storyDirectionForward) {
            fadeWesternAudio(4000);
            revealGameShell();
            if (pixelScene) {
              pixelScene.style.animation = "none";
              pixelScene.style.opacity = "1";
            }
            if (finalCall && !finalCallShown) {
              finalCallShown = true;
              finalCall.style.display = "grid";
              finalCall.classList.add("show");
            }
            storyEl.classList.add("paused");
            storyEl.style.animationPlayState = "paused";
          }
        }
      });

      async function playWildAudio() {
        if (!wildAudio || wildAudioStarted) return;
        wildAudio.currentTime = 0;
        wildAudio.volume = 0.8;
        wildAudio.muted = false;
        try {
          const playPromise = wildAudio.play();
          if (playPromise && typeof playPromise.then === "function") {
            await playPromise;
          }
          wildAudioStarted = true;
        } catch (e) {
          // allow retry on next gesture if autoplay is blocked
          wildAudioStarted = false;
        }
      }

      async function playWesternAudio() {
        if (!westernAudio || westernAudioStarted) return;
        if (westernPlayCount >= WESTERN_MAX_PLAYS) return;
        westernAudio.currentTime = 0;
        westernAudio.volume = 0.6;
        westernAudio.muted = false;
        try {
          const playPromise = westernAudio.play();
          if (playPromise && typeof playPromise.then === "function") {
            await playPromise;
          }
          westernAudioStarted = true;
          westernPlayCount += 1;
        } catch (e) {
          westernAudioStarted = false;
        }
      }

      function fadeWesternAudio(durationMs = 4000) {
        if (!westernAudio) return;
        const startVol = westernAudio.volume;
        const start = performance.now();
        function step(now) {
          const t = Math.min((now - start) / durationMs, 1);
          westernAudio.volume = startVol * (1 - t);
          if (t < 1) {
            requestAnimationFrame(step);
          } else {
            westernAudio.pause();
            westernAudio.currentTime = 0;
            westernAudioStarted = false;
            revealGameShell();
          }
        }
        requestAnimationFrame(step);
      }

      if (westernAudio) {
        westernAudio.addEventListener("ended", () => {
          westernAudioStarted = false;
          if (westernPlayCount < WESTERN_MAX_PLAYS) {
            playWesternAudio();
          }
        });
      }

      function playWheelAudio() {
        if (!wheelAudio) return;
        wheelAudio.currentTime = 0;
        wheelAudio.muted = false;
        wheelAudio.volume = 0.9;
        wheelAudio.play().catch(() => {});
      }

      function stopWheelAudio() {
        if (!wheelAudio) return;
        wheelAudio.pause();
        wheelAudio.currentTime = 0;
      }

      function playDingAudio() {
        if (!dingAudio) return;
        dingAudio.currentTime = 0;
        dingAudio.volume = 0.8;
        dingAudio.play().catch(() => {});
      }

      function playFailAudio() {
        if (!failAudio) return;
        failAudio.currentTime = 0;
        failAudio.volume = 0.8;
        failAudio.play().catch(() => {});
      }

      function playWinAudio() {
        if (!winAudio) return;
        winAudio.currentTime = 0;
        winAudio.volume = 0.85;
        winAudio.play().catch(() => {});
      }

      function playOhNoAudio() {
        if (!ohNoAudio) return;
        ohNoAudio.currentTime = 0;
        ohNoAudio.volume = 0.8;
        ohNoAudio.play().catch(() => {});
      }


      function startMoneyRain() {
        if (!moneyRain) return;
        stopMoneyRain();
        moneyInterval = setInterval(() => {
          const bill = document.createElement("div");
          bill.className = "bill";
          bill.style.left = `${Math.random() * 100}%`;
          bill.style.animationDuration = `${4 + Math.random() * 3}s`;
          bill.style.transform += ` rotate(${(Math.random() * 40 - 20).toFixed(1)}deg)`;
          moneyRain.appendChild(bill);
          bill.addEventListener("animationend", () => bill.remove());
        }, 250);
      }

      function stopMoneyRain() {
        if (moneyInterval) {
          clearInterval(moneyInterval);
          moneyInterval = null;
        }
        if (moneyRain) {
          moneyRain.innerHTML = "";
        }
      }

      if (horseEl) {
        horseEl.addEventListener("animationstart", () => {
          playWildAudio();
        });
      }

      // fallback: first user interaction triggers audio if blocked
      window.addEventListener(
        "pointerdown",
        () => {
          playWildAudio();
          playWesternAudio();
        },
        { once: true }
      );

      // Prime audio in muted autoplay to satisfy mobile/desktop policies
      if (wildAudio) {
        wildAudio.muted = true;
        wildAudio.play().catch(() => {
          /* autoplay blocked until interaction */});
      }
      if (westernAudio) {
        westernAudio.muted = true;
        westernAudio.play().catch(() => {
          /* autoplay blocked until interaction */});
      }

      // start western theme immediately (will unmute when play succeeds)
      playWesternAudio();

      if (startShowBtn) {
        startShowBtn.addEventListener("click", () => {
          if (horseEl) {
            // restart animation from beginning each time
            horseEl.classList.remove("animate");
            horseEl.style.animation = "none";
            // force reflow
            // eslint-disable-next-line no-unused-expressions
            horseEl.offsetWidth;
            horseEl.style.animation = "";
            horseEl.classList.add("animate");
          }
          playWildAudio();
          if (startGameBtn) startGameBtn.classList.remove("hidden");
        });
      }

      if (startGameBtn) {
        startGameBtn.addEventListener("click", () => {
          revealGameShell();
          if (finalCall) {
            finalCall.classList.remove("show");
            finalCall.style.display = "none";
            finalCallShown = false;
          }
        });
      }

      if (testSolveBtn) {
        testSolveBtn.addEventListener("click", () => {
          // mark all letters as guessed
          PHRASE.split("").forEach((ch) => {
            if (ch !== " ") guessed.add(ch.toUpperCase());
          });
          revealGameShell();
          renderPhrase();
          setSolvedUI();
        });
      }
    })();
  </script>
</body>
</html>
